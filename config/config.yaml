pose:
  model_name: "yolo26n-pose.pt" # Pretrained model to start from
  imgsz: 640
  batch: 20
  workers: 12 # DataLoader (CPU/I/O). Teste 8, 12 e 16.
  cache: ram # false | ram | disk. "ram" acelera leitura se houver memoria.
  amp: true # mixed precision na GPU (mais rapido e menor uso de VRAM)
  epochs: 200
  patience: 50 # Early stopping epochs
  device: "0" # "cpu" or "0", "1", etc.
  k_folds: 5
  # Estrategias de validacao para treino de pose:
  # - "kfold_misturado":
  #   KFold comum com shuffle. Mistura imagens livremente entre folds.
  #   Mais rapido/simples, mas pode superestimar metricas quando ha imagens muito parecidas
  #   (mesma sessao/camera) em treino e validacao.
  #
  # - "groupkfold_por_sessao":
  #   GroupKFold agrupando por sessao de captura (data + baia/estacao + camera, inferidos do nome do arquivo).
  #   Evita vazamento de contexto entre treino e validacao no mesmo fold.
  #   Recomendado para medir generalizacao real.
  #
  # - "groupkfold_por_anotador":
  #   GroupKFold agrupando por um proxy de "origem/anotador" (prefixo do nome + camera).
  #   Mais restritivo: separa por origem de anotacao para reduzir viÃ©s de anotador/lote.
  #   Pode reduzir metricas de validacao, mas deixa o teste mais robusto.
  #
  # Observacoes:
  # - Se houver poucos grupos para o numero de folds (k_folds), o pipeline faz fallback para kfold_misturado.
  # - O valor e lido como texto; qualquer valor iniciando com "groupkfold" ativa logica de GroupKFold.
  estrategia_validacao: "groupkfold_por_sessao"
  forcar_diversidade_batch: true
  usar_data_augmentation: true
  augmentacao:
    hsv_h: 0.015
    hsv_s: 0.7
    hsv_v: 0.4
    degrees: 5.0
    translate: 0.10
    scale: 0.50
    shear: 2.0
    perspective: 0.0005
    fliplr: 0.0
    flipud: 0.0
    mosaic: 0.7
    mixup: 0.1
    erasing: 0.2

classificacao:
  # Modelos suportados: "xgboost", "catboost", "sklearn_rf"
  modelo_padrao: "sklearn_rf"
  usar_data_augmentation: true # Liga/desliga augmentation para classificacao
  augmentacao_keypoints:
    habilitar: true # Ativa augmentation em keypoints (alem da flag global acima)
    n_copias: 10 # Quantas copias sinteticas gerar por instancia real de treino
    noise_std_xy: 0.004 # Intensidade do ruido gaussiano em XY (escala relativa ao bbox)
    conf_min_keypoint: 0.01 # So aplica ruido em keypoints com confianca >= este valor
    clip_coords: true # Limita coordenadas para dentro da imagem apos ruido
    deterministico: true # Se true, repete exatamente a mesma augmentation entre execucoes
    seed: 42 # Semente do gerador aleatorio quando deterministico=true
  normalizar_orientacao: false   # deve ser true se fliplr > 0
  selecao_instancia:
    conf_min: 0.4
    peso_area: 0.5
    peso_confianca: 0.5
    bonus_centro: 0.2
  validacao_interna:
    fracao: 0.2
    early_stopping_rounds: 50
    usar_apenas_real: true # Se true, validacao interna usa apenas origem_instancia=real
  # Hiperparametros base do XGBoost (usados diretamente quando otimizacao_hiperparametros.habilitar=false)
  xgboost:
    n_estimators: 1000
    learning_rate: 0.05
    max_depth: 6
    min_child_weight: 1.0
    subsample: 0.8
    colsample_bytree: 0.8
    gamma: 0.0
    reg_alpha: 0.0
    reg_lambda: 1.0
    random_state: 42
    tree_method: "hist"
    device: "cuda" # "cuda" ou "cpu"
    n_jobs: -1
  # Hiperparametros base do CatBoost (usados diretamente quando otimizacao_hiperparametros.habilitar=false)
  catboost:
    iterations: 1000
    learning_rate: 0.05
    depth: 6
    l2_leaf_reg: 3.0
    random_strength: 1.0
    bagging_temperature: 0.5
    rsm: 0.8
    eval_metric: "MultiClass"
    random_seed: 42
    device: "cuda" # "cuda" ou "cpu"
  # Hiperparametros base do RandomForest (usados diretamente quando otimizacao_hiperparametros.habilitar=false)
  rf:
    n_estimators: 400
    max_depth: null
    min_samples_split: 2
    min_samples_leaf: 1
    max_features: "sqrt" # "sqrt", "log2" ou null
    bootstrap: true
    class_weight: null # null ou "balanced"
    random_state: 42
    n_jobs: -1
  # Otimizacao de hiperparametros para XGBoost/CatBoost/RandomForest (menos forca bruta que GridSearch).
  # metodo:
  # - "optuna": TPE/Bayesiano (preferencial, requer optuna instalado)
  # - "random": busca aleatoria simples (fallback)
  otimizacao_hiperparametros:
    habilitar: true
    metodo: "optuna"
    n_trials: 40
    timeout_segundos: null
    seed: 42
  features:
    # Ordem de importancia (gain) do ultimo treino com todas as features.
    # Top 10 ativos; restante comentado para liberar um a um.
    selecionadas:
      - "dist_hip_tail_head"
      - "dist_tail_head_pin_up"
      - "razao_dist_back_hip_por_dist_hip_hook_up"
      - "bbox_aspect_ratio"
      - "pca_excentricidade"
      - "sc_pin_up_y"
      - "angulo_hook_up_pin_up_tail_head"
      - "angulo_hook_up_hip_tail_head"
      - "sc_hook_up_y"
      - "razao_dist_hip_hook_up_por_dist_hook_up_pin_up"
      - "angulo_hook_up_back_hook_down"
      - "sc_back_y"
      - "angulo_pin_up_hip_pin_down"
      - "sc_back_x"
      - "dist_back_hook_up"
      - "sc_hip_y"
      - "area_poligono_pelvico_norm"
      - "sc_hook_down_y"
      - "sc_hook_up_x"
      - "sc_pin_up_x"
      - "bbox_area_norm"
      - "razao_dist_hip_hook_down_por_dist_hook_down_pin_down"
      - "razao_dist_hip_tail_head_por_dist_hook_down_pin_down"
      - "razao_dist_hip_tail_head_por_dist_hook_up_pin_up"
      - "razao_dist_hip_hook_up_por_dist_hip_tail_head"
      # - "razao_dist_hip_hook_down_por_dist_hip_tail_head"
      # - "razao_dist_back_hip_por_dist_hip_tail_head"
      # - "razao_dist_back_hip_por_dist_hip_hook_down"
      # - "razao_dist_back_hip_por_dist_hip_pin_up"
      # - "razao_dist_back_hip_por_dist_hip_pin_down"
      # - "razao_largura_hooks_por_largura_pins"
      # - "angulo_hook_up_hip_hook_down"
      # - "angulo_hip_hook_up_pin_up"
      # - "angulo_hip_hook_down_pin_down"
      # - "angulo_hook_down_hip_tail_head"
      # - "angulo_pin_up_tail_head_pin_down"
      # - "angulo_withers_back_tail_head"
      # - "area_triangulo_torax_norm"
      # - "indice_robustez"
      # - "indice_triangulo_traseiro"
      # - "desvio_coluna_back_norm"
      # - "desvio_coluna_hip_norm"
      # - "sc_withers_x"
      # - "sc_withers_y"
      # - "sc_hook_down_x"
      # - "sc_hip_x"
      # - "sc_tail_head_x"
      # - "sc_tail_head_y"
      # - "sc_pin_down_x"
      # - "sc_pin_down_y"

paths:
  raw: "dados/raw"
  processed: "dados/processados"
  models: "modelos"
  outputs: "saidas"
